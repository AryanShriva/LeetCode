import java.util.*;

class Solution {
    // Function to simulate malware spread via DFS
    private void dfs(int node, Set<Integer> spreadNodes, boolean[] visited, int[][] graph, Set<Integer> infectedSet) {
        visited[node] = true;
        spreadNodes.add(node);
        for (int i = 0; i < graph.length; i++) {
            if (graph[node][i] == 1 && !visited[i] && !infectedSet.contains(i)) {
                dfs(i, spreadNodes, visited, graph, infectedSet);
            }
        }
    }

    public int minMalwareSpread(int[][] graph, int[] initial) {
        int n = graph.length;

        // Sort initial nodes to ensure we can return the smallest index in case of tie
        Arrays.sort(initial);

        // 1. Find which nodes each initial infected node can infect.
        // infectedCount[i] tells how many nodes will be infected if we remove node i
        int[] infectedCount = new int[n];

        // Mark all infected nodes in the graph
        Set<Integer> infectedSet = new HashSet<>();
        for (int node : initial) {
            infectedSet.add(node);
        }

        // 2. For each node in initial[], calculate the effect of removing that node
        int resultNode = -1;
        int minInfected = Integer.MAX_VALUE;

        for (int removeNode : initial) {
            // Simulate the scenario where we remove `removeNode`
            infectedSet.remove(removeNode);

            // Reset visited for new DFS search
            boolean[] visited = new boolean[n];
            Set<Integer> spreadNodes = new HashSet<>();

            // Run DFS to spread malware from other nodes
            for (int node : initial) {
                if (node != removeNode && !visited[node]) {
                    dfs(node, spreadNodes, visited, graph, infectedSet);
                }
            }

            // Count the number of infected nodes
            int infectedSize = spreadNodes.size();

            // Check if this node's removal results in fewer infected nodes
            if (infectedSize < minInfected) {
                minInfected = infectedSize;
                resultNode = removeNode;
            }

            // Restore infected node back to the set
            infectedSet.add(removeNode);
        }

        return resultNode;
    }
}
